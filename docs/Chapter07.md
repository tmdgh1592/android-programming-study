# 7️⃣ 안드로이드 SDK 버전과 호환성

### 구 버전의 안드로이드가 실행되는 장치가 여전히 많은 이유

- 안드로이드 장치 제조사나 통신사 간의 과도한 경쟁 때문이다.
  - 통신사들은 경쟁사에는 없는 특성과 장치를 원한다.
  - 장치 제조사들 역시 이런 압력을 받는다.
  - 즉, 모든 제조사의 폰이 같은 운영체제를 기반으로 하지만, 다른 제조사와의 경쟁에서는 이겨야 하기 때문이다.
  - 그러므로 각 제조사의 안드로이드 장치는 구글이 배포한 새로운 버전의 순정 안드로이드를 그대로 사용하지 않는다.
  - 이로 인해 각 제조사의 장치에 새로운 안드로이드 버전이 설치되고 최적화되려면 수개월 이상의 시간이 필요하다.
  - 또한 각 제조사는 오래된 장치를 최신 버전으로 업데이트해주기보다는 새로운 장치에 그 자원을 집중한다.

### 호환성과 안드로이드 프로그래밍

- 새로운 배포와 결합되는 업그레이드가 지연됨에 따라 호환성이 안드로이드 프로그래밍에서 매우 중요해졌다.
- 폭넓은 시장에 대응하기 위해 안드로이드 개발자들은 다양한 안드로이드 버전을 실행하는 장치와 서로 다른 장치 폼팩터(예를 들어, 폴더블 폰) 모두에서 실행이 잘 되는 앱을 만들어야 한다.

### 지원 안드로이드 버전 설정

- 최소 지원 버전, 목표 버전, 컴파일 버전 설정이 가능하다.
- app 모듈의 `build.gradle` 파일에 설정되며, 컴파일 버전 속성은 이 파일에만 설정되어 있다.
  - `compileSdkVersion`
  - `minSdkVersion`
  - `targetSdkVersion`
- 최소 SDK 버전과 목표 SDK 버전도 `build.gradle` 파일에 설정되어 있지만, 매니페스트 파일(AndroidManifest.xml)에서도 값을 설정할 수 있다.

### 최소 SDK 버전

- `minSdkVersion` 값은 앱을 설치하는 기준으로 삼는 최소한의 안드로이드 버전이다.
- `minSdkVersion` 보다 낮은 버전의 안드로이드 장치에서 앱을 설치하려고 하면 안드로이드가 거부한다.

### 목표 SDK 버전

- `targetSdkVersion` 값은 앱 설계에 사용된 API 레벨을 안드로이드에 알려준다.
- 대부분의 경우에 이 값이 가장 최신의 안정화된 안드로이드 버전이 되는데, 그 이유는 하위 버전과의 호환성이 유지되기 때문이다.
- 목표 SDK를 더 하위 버전으로 지정하는 경우
  - 앱이 잘 작동하던 상위 버전에서 동작했던 대로 하위 버전에서도 여전히 잘 작동하는지 확인하려면 목표 SDK를 하위 버전으로 지정해야 한다.
  - **이때 그 하위 버전 이후의 SDK에서 변경된 내용은 무시된다.**
- 구글 플레이 스토어에 신규 앱이나 앱의 업데이트를 올리고자 한다면 목표 SDK의 최저 버전에 제한이 있음을 유의해야 한다.
  - 최신 버전의 성능이나 보안성 개선 등의 장점을 사용자가 얻을 수 있도록 목표 SDK의 최저 버전보다 낮은 버전의 목표 SDK 앱은 플레이 스토어에서 거부된다.

### 컴파일 SDK 버전

- `compileSdkVersion` 는 매니페스트 파일(AndroidManifest.xml)에는 사용되지 않으며 우리와 컴파일러만 아는 정보다.
- 컴파일 SDK 버전은 코드를 빌드할 때 사용하는 버전이며, 안드로이드 스튜디오가 import 문으로 참조되는 클래스나 함수를 찾을 때 어떤 버전의 SDK에서 찾을 것인가를 결정하는 것이 바로 이 버전이다.
- 컴파일 SDK 버전을 선택할 때 가장 좋은 방법은 가장 최신에 가까우면서 안정된 API 레벨을 선택하는 것이다.
- 필요하다면 기존 앱의 컴파일 SDK 버전을 변경할 수 있다.

### 상위 버전의 API 코드 안전하게 추가하기

- 최소 SDK 버전보다 상위 버전의 SDK 코드를 사용하고 앱을 실행시키면 앱이 중단되거나 해당 코드가 무시된다.
- 다행히도 Lint 덕분에 하위 버전 장치에서 상위 버전의 코드를 호출함으로써 생기는 문제를 컴파일 시점에 잡아낼 수 있다.
  - 최소 SDK 버전보다 상위 버전의 코드를 사용하면 안드로이드 Lint가 경고해준다.

### Jetpack 라이브러리

- API 레벨을 고려하여 코드를 작성하면 다음의 두 문제가 존재한다.
  - 안드로이드 버전마다 다른 코드가 실행되게 해야 하므로 추가 코드를 작성해야 한다.
  - 장치에서 실행되는 안드로이드 버전에 따라 앱이 다르게 실행되므로 사용자 경험이 달라진다.
- Jetpack 라이브러리는 새로운 기능과 함께 이에 대한 하위 호환성을 제공한다.
- 따라서 Jetpack 라이브러리를 사용하면 조건문을 사용한 API 레벨 확인 코드를 작성하지 않아도 된다.
- 하지만  Jetpack 라이브러리는 모든 기능을 포함하지는 않는다.
- 그렇기 때문에  Jetpack 라이브러리가 지원하지 않는 기능의 경우 추가될 때까지 불가피하게 안드로이드 버전 확인 코드를 따로 작성해야 한다.
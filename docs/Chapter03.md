# 3️⃣ 액티비티 생명주기

### 액티비티 상태와 생명주기 콜백

- `activity`의 모든 인스턴스는 생명주기를 갖는다.

- 생명주기 동안에 액티비티는 네 가지 상태인 `실행 재개(resumed)`, `일시 중지(paused)`, `중단(stopped)`, `존재하지 않음(nonexistent)`으로 상호 전환된다.

- 각 전환이 발생할 때 액티비티에 상태 변경을 알려주는 `activity functions(생명주기 콜백)`가 있으며, 안드로이드에 의해 자동 호출된다.

- 액티비티 상태

  | 상태        | 메모리에 존재 | 사용자에게 보임    | 포그라운드에서 실행 |
  | ----------- | ------------- | ------------------ | ------------------- |
  | nonexistent | X             | X                  | X                   |
  | stopped     | O             | X                  | X                   |
  | paused      | O             | O (일부 또는 전체) | X                   |
  | resumed     | O             | O                  | O                   |

  - 생애
    - 전체 생애 - 액티비티의 인스턴스가 메모리에 존재한다.
    - 가시적 생애 - 액티비티 화면의 일부 또는 전체가 사용자에게 보인다.
    - 포그라운드 생애 - 사용자가 해당 액티비티와 상호 작용하고 있다.
  - 상태
    - 존재하지 않음(nonexistent)
      - 액티비티가 아직 론칭되지 않았거나 소멸되었음을 나타낸다.
      - 소멸(destroyed) 상태라고도 한다.
      - 액티비티 인스턴스는 메모리에 존재하지 않으며, 사용자가 보거나 상호 작용하기 위한 뷰도 없다.
    - 중단(stopped)
      - 액티비티 인스턴스가 메모리에 있지만, 뷰는 화면에서 볼 수 없는 상태를 나타낸다.
      - 액티비티가 처음 시작될 때 거쳐가는 상태이며, 액티비티 인스턴스의 뷰가 화면에서 완전히 가려졌을 때 언제든 다시 진입하는 상태이다.
      - 예를 들어, 전체 화면을 사용하는 다른 액티비티를 사용자가 시작하거나 홈 버튼을 누를 때 이 상태로 전환된다.
    - 일시 중지(paused)
      - 액티비티가 포그라운드에서 작동하지는 않지만, 액티비티 인스턴스의 뷰 전체 또는 일부를 화면에서 볼 수 있는 상태를 나타낸다.
      - 예를 들어, 액티비티 위에 새로운 대화상자나 투명 액티비티가 사용자에 의해 시작되어 이 액티비티의 일부만 화면에 보일 때 이 상태로 전환된다.
      - 다중 창 모드(또는 분할 화면 모드)로 두 개의 액티비티를 같이 보고 있는 경우, 액티비티의 전체가 화면에 보일 수 있지만 포그라운드에 존재하지 않을 수도 있는데 이 경우에도 이 상태로 전환된다.
    - 실행 재개(resumed)
      - 액티비티가 메모리에 있으면서 화면에서 전체를 볼 수 있고 포그라운드에 있는 상태를 나타낸다.
      - 사용자가 현재 상호 작용하고 있는 액티비티가 이 상태에 해당한다.
      - 장치의 전체 시스템에 걸쳐 하나의 액티비티만 될 수 있다.

### onCreate(Bundle?) 생명주기 콜백

- UI(사용자 인터페이스)를 준비하기 위해 액티비티에서는 다음과 같이 오버라이드(override) 한다.
  - 위젯을 인플레이트해 뷰 객체로 생성한 후 화면에 보여준다(setContentView(Int)를 호출).
  - 인플레이트된 위젯의 객체 참조를 얻는다.
  - 사용자와의 상호 작용을 처리하기 위해 위젯에 리스너를 설정한다.
  - 외부의 모델 데이터를 연결한다.
- override 키워드가 있는 이유는 오버라이드하는 함수가 슈퍼 클래스에 있는지 컴파일러에게 확인하라고 요청하기 위해서다.

### 장치 구성 변경과 액티비티 생명주기

- 장치 구성(device configuration)은 각 장치의 현재 상태를 나타내는 특성들의 집합이다.
- 장치 구성을 이루는 특성에는 화면 방향, 화면 밀도, 화면 크기, 키보드 타입, 도크(dock) 모드, 언어 등이 있다.
- 장치를 회전하면 장치 구성이 변경된다.
- 일반적으로 앱에서는 서로 다른 장치 구성에 맞추기 위해 대체 리소스를 제공한다. 예를 들어, 화면 밀도에 따른 drawable, 화면 방향에 따른 layout 등이 있다.
- **런타임 구성 변경(runtime configuration change)**이 생길 때는 새로운 구성에 더 잘 맞는 리소스들이 있을 수 있다. 따라서 안드로이드는 현재의 액티비티 인스턴스를 소멸시키고 새로운 구성에 가장 적합한 리소스를 찾는다. 그리고 그런 리소스를 사용해서 해당 액티비티의 새 인스턴스를 다시 빌드한다.

### UI 변경과 다중 창 모드

- 다중 창 모드가 지원되지 않던 안드로이드 7.0 이전에는 대부분의 액티비티가 매우 짧은 시간 동안만 `일시 중지` 상태에 머물렀다. 이런 이유로 UI와 관련해서 진행 중인 변경(예를 들어, 애니메이션이나 데이터 갱신)의 시작과 중단을 `onResume()`과 `onPause()`에서 하는 것이 일반적이었다.
- 다중 창 모드가 지원되는 안드로이드 7.0 부터는 `일시 중지` 상태에도 사용자들은 액티비티가 실행 중이라고 생각할 수 있다. 그렇기 때문에 액티비티 화면을 볼 수 있는 `onStart()`부터 `onStop()`까지의 전체 생명주기 동안에 UI를 변경해야 한다.
- 2018년 11월 구글 안드로이드 팀은 다중 창 모드의 `다중 실행 재개(multi-resume)` 지원 사양을 내놓았다. 즉, 다중 창 모드의 장치에서는 사용자가 어떤 창의 앱을 사용하건 각 창에 완전하게 보이는 액티비티들은 `실행 재개` 상태가 된다. 이로 인해 굳이 안드로이드 7.0 이전의 앱들을 수정하지 않아도 다중 창 모드에서 문제 없이 실행될 수 있게 되었다.
- 안드로이드 9.0 Pie(파이) 이상에서 앱이 실행될 때는 매니페스트 파일에 태그를 추가하여 `다중 실행 재개` 모드를 사용할 수 있다.

### 로그 레벨

| 로그 레벨 | 함수     | 용도                        |
| --------- | -------- | --------------------------- |
| ERROR     | Log.e(…) | 에러                        |
| WARNING   | Log.w(…) | 경고                        |
| INFO      | Log.i(…) | 정보성 메시지               |
| DEBUG     | Log.d(…) | 디버깅 출력이며 필터링 가능 |
| VERBOSE   | Log.v(…) | 개발 전용                   |

- `android.util.Log` 클래스로 로그 메시지를 출력하면 메시지의 내용은 물론이고 메시지의 중요도를 나타내는 레벨(level)도 제어할 수 있다.
- 각 레벨은 자신과 부합하는 Log 클래스의 함수를 가진다.
- 각 로깅 함수는 두 개의 시그니처(signature)를 갖는다.
  - `태그 문자열`과 `메시지 문자열`로 된 두 개의 인자를 받는 시그니처
  - 위의 두 인자에 `Throwable 인스턴스`를 추가로 받는 시그니처 여기서 Throwable 인스턴스는 앱이 발생시킬 수 있는 특정 예외에 관한 정보를 쉽게 로깅할 수 있게 한다.
